on:
  push:
    branches: master
  pull_request:
    branches: master
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:

    - uses: actions/checkout@v4

    - name: Haskell versions
      run: |
        which cabal
        cabal --version
        ghc --version

    - name: Set installdir
      run: |
        cabal user-config init
        cabal user-config update --augment="installdir: /home/runner/.local/bin"
        cabal user-config update --augment="install-method: copy"
        cabal user-config update --augment="overwrite-policy: always"

    - run: echo "$PATH"

    - name: Print config file
      run: |
        CFG=$(cabal --help | tail -1)
        echo ${CFG}
        cat ${CFG}
        echo "CFG=${CFG}" >> "${GITHUB_ENV}"

    - run: cabal update

    - run: cabal install --ignore-project alex-3.4.0.1

    - run: |
        alex --version
        which alex

    - run: cabal build
